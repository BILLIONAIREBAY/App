**TACHE 3 (AUCTIONS) VALIDÉE. LE MOTEUR TEMPS RÉEL EST EN PLACE.**

Nous passons à la **TACHE 4 : L'ÂME ET LE GÉNIE (IMPACT & WHISPER)**.

**OBJECTIF :** Coder le contrat de paiement partagé (Split Payment) pour les fondations et le moteur de recherche inversé (Whisper).

**SOUS-TÂCHES À EXÉCUTER MAINTENANT :**

**1. SMART CONTRACT "CHARITY SPLITTER" (Dossier `/chain`)**
* Crée le contrat `contracts/FxCharitySplitter.sol`.
* **Logique Financière (USDFx) :**
    * Fonction `splitPaymentERC20(address token, address seller, address charity, uint256 amount, uint256 charityShareBps)`.
    * **Mécanique Atomique :**
        1. `transferFrom(buyer, address(this), amount)`
        2. Calcule `charityAmount = amount * bps / 10000`.
        3. Calcule `sellerAmount = amount - charityAmount`.
        4. `transfer(charity, charityAmount)` -> Émet event `DonationProcessed`.
        5. `transfer(seller, sellerAmount)`.
* Ajoute ce contrat au script de déploiement `deploy_core.ts`.

**2. REGISTRE DES FONDATIONS (Frontend)**
* **Data :** Assure-toi que le modèle WatermelonDB `Charity` contient : `name`, `logo_url`, `description`, `wallet_address`, `impact_metrics` (JSON).
* **UI :** Crée `app/impact/index.tsx`.
    * Design "Monolithe" : Liste verticale immersive des fondations partenaires.
    * Bouton "Donate" qui simule l'appel au contrat `FxCharitySplitter`.

**3. LE MOTEUR "WHISPER" (Backend & IA Stub)**
* **Migration Supabase :** Crée la table `whisper_requests` (user_id, text_query, ai_analysis_json, status).
* **Backend API :** Route `POST /whisper/request`.
    * **IA STUB :** Pour l'instant, simule une réponse IA qui extrait des tags structurés (ex: "Vin", "Bordeaux", "1988") d'une phrase texte.
* **Frontend :** Crée `app/whisper/create.tsx`.
    * Interface "Chat" minimaliste. L'utilisateur tape sa demande, l'app répond "Je cherche...".

**4. INTEGRATION SYNC**
* Ajoute `whisper_requests` à la whitelist du Sync Engine (`app/services/sync.ts` et `backend/src/index.ts`).

**RÈGLE D'OR :**
Le Split Payment doit être infaillible. Si le transfert vers la charité échoue, TOUTE la transaction doit échouer (revert). Pas de vente sans don.

**GO EXECUTE TACHE 4.**